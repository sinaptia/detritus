#!/usr/bin/env ruby
# web-search: Searches the web using Gemini's web search summarization capability
require "bundler/inline"

gemfile do
  source "https://rubygems.org"
  gem "ruby_llm", "~> 1.11"
end

require "optparse"

parser = OptionParser.new do |opts|
  opts.banner = "Usage: web-search <query>"
  opts.on("-h", "--help", "Show this help") {
    puts opts
    exit
  }
end

parser.parse!

if ARGV.empty?
  puts parser
  exit 1
end

query = ARGV.join(" ")

RubyLLM.configure do |c|
  c.gemini_api_key = ENV["GEMINI_API_KEY"]
end

chat = RubyLLM.chat(model: "gemini-2.5-flash")
chat.with_params(tools: [{google_search: {}}])
chat.with_instructions("Use your web search capabilities to provide comprehensive information. Include at least 10 results with source urls.")
puts chat.ask(query).content
